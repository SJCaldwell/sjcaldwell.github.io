<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.52">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Shane Caldwell">
<meta name="dcterms.date" content="2024-07-01">

<title>Learn You a Haskell to Empathize with Religious Devotion: Part 1 – Shane Caldwell</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Shane Caldwell</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../talks.html"> 
<span class="menu-text">Papers and Talks</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/SJCaldwell"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/shncldwll"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Learn You a Haskell to Empathize with Religious Devotion: Part 1</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">programming</div>
                <div class="quarto-category">fp</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Shane Caldwell </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 1, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-guy-i-talked-to-who-loved-haskell-and-it-changed-his-life-not-clickbait" id="toc-the-guy-i-talked-to-who-loved-haskell-and-it-changed-his-life-not-clickbait" class="nav-link active" data-scroll-target="#the-guy-i-talked-to-who-loved-haskell-and-it-changed-his-life-not-clickbait">The Guy I talked to who loved Haskell (and it changed his life (not clickbait))</a></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources">Resources</a>
  <ul class="collapse">
  <li><a href="#books" id="toc-books" class="nav-link" data-scroll-target="#books">Books</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>I’m presently studying functional programming for the first time using Haskell. This is the type of thing one gets to do when being unemployed - study a topic of intellectual interest that absolutely had not come up in my daily life as an MLE, nor as a pentester.</p>
<p>My interest in Haskell is probably similar to yours having clicked on this article. You’ve heard things. Once you program in a <em>pure functional</em> language for long enough, the way you solve problems change. This insight, once acquired, effects the rest of the long tail of your software career. Your brain gets bigger. The sky gets bluer. Activities you used to love once again provide pleasure.</p>
<p>The people who love it claim to really love it. Other people say it’s a purely academic language not used by people who write serious software. But the success of pandoc and xmonad suggest the truth is somewhere inbetween. Also, <a href="https://gwern.net/design">Gwern’s Blog</a> uses it and I would like to imitate Gwern’s blog. And so I wanted to take the time to study it seriously, and writing that up for you, dear reader, is my way of holding you accountable.</p>
<p>I’ve tried writing Haskell before. Or, that is, I’ve tried reading the book <em>Learn You a Haskell For Great Good</em> probably three times, getting through chapter two or so each time before bouncing off of it. I definitely heard the words that Haskell was statically typed, lazily evaluated, and without side effects multiple times. Thankfully, I was writing Java for a college class at the time, so I actually knew what it meant to be statically typed. The others, eh, not so much.</p>
<p>But the main reason for learning Haskell isn’t really about the practicalities. It’s about trying to understand the near religious devotion fans of the language have to it. As an ml engineer/pentester, my daily driver is python. Its been python, it’ll probably always be python <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.That said, I don’t <em>like</em> python. I don’t really care about python either way. I like the dynamic type system when I’m writing scripts for a small project, I hate trying to maintain a large codebase in it, but I usually work at startups or as a consultant so you can graph my dissatisfaction falling the longer I work on any given problem with it and usually it just doesn’t matter. It solves my problem and its ecosystem is so unbearably large that I very infrequently have to write any code that isn’t super specific to my business/design/security/research problem. So I tolerate it.</p>
<p>Haskell writers <em>love</em> it, though. There is a whole bonafide cult around it. And if you’re anything like me, you probably believe that love is overblown. It’s mostly just dudes talking on the internet and it is much more likely that someone being loud about a programming language online doesn’t write very much software and is just into getting into cultural arguments than it is that they actually care about the language. I can’t prove that’s <em>not</em> the case, but I can tell you a compelling anecdote about one such acolyte, which is worth whatever <span class="math inline">\(n=1\)</span> can be.</p>
<section id="the-guy-i-talked-to-who-loved-haskell-and-it-changed-his-life-not-clickbait" class="level3">
<h3 class="anchored" data-anchor-id="the-guy-i-talked-to-who-loved-haskell-and-it-changed-his-life-not-clickbait">The Guy I talked to who loved Haskell (and it changed his life (not clickbait))</h3>
<p>In college I spent a lot of time thinking about starting a startup. The curious thing about being an undergrad who wants to start a startup is you’re sort of a worshipper in want of a deity. You don’t have a whole lot of technical expertise yet<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> but you want to be all in on some particular problem. My pet problem for that semester was the tooling for collaborative scientific research.</p>
<p>Fresh off a bioinformatics summer internship where I’d been the only programmer in a wet lab, I was appalled at the state of project management. People were passing Microsoft Word files around, for God’s sake. They didn’t even know about git. Tracking changes was difficult, tracking down data was difficult, etcetera. All problems we’d solved in software<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. So, I decided my business would be about creating modern research management software built on top of git that would introduce the 21st century to all sorts of research endeavors. Cool!<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<p>I googled around trying to see if anyone had ever <em>tried</em> a business like this before. It turns out that someone had - and not only had they, they had been in the same Florida area as me! I found their website, which seemed to be defunct. Articles I found online suggested they’d been started only a year or two prior. These struck me as bad signs, but with the rose-colored glasses of new-endeavor-mania upon you the red flags, as they say, just look like flags.</p>
<p>I figured I would get ahold of one of the founders who had worked on the project. There was only one whose email still seemed to be active, but the easiest way to reach out to him seemed to be Google Plus<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>. I messaged him on the spot. It was maybe midnight, so I didn’t expect to hear anything back that night, if I ever heard anything back at all. My message was basically some variation of:</p>
<p>“I wanna do what you guys did at X. It seems like it didn’t work out for you. Can you maybe provide some advice as to what you would’ve done differently, and what big assumptions you made that didn’t end up being true?”</p>
<p>He responded almost immediately. Super nice guy. He explained that the company had been built on top of a fork of Gitlab, tuned towards researchers. He explained that the initial response from academics had been really solid, and they were in talks with a variety of universities when they dissolved. That, it turned out, had been the problem. The buying cycle for the average university was just <em>too long</em>. They died waiting for a handful of checks that would’ve sustained them for at least another year, all because they misunderstood the spending cycles and timelines of their biggest potential customers.</p>
<p>“Damn, dude,” I typed back, “That’s a bummer. Anything you would do differently?”</p>
<p>Again, I wasn’t expecting an answer. That didn’t occur to me as a “do differently” problem, that seemed closer to an “I accidentally got really excited about an industry not conducive to bootstrapped product startups” problem. Also, it’d been a year, not many people would want to really dig into their failure with some random guy on the internet. But I got an answer. It basically went:</p>
<p>“Instead of using Gitlab, I would’ve rewritten the backend in Haskell. It’s just so much more fun to write, and the code is basically bug-free.”</p>
<p>That didn’t seem like it would’ve made a real difference in whether the startup would’ve succeeded though. It actually sounds like it would’ve made it worse, since your time to build a prototype is higher (porting all that rails of Gitlab to Haskell), meaning you’d find out about your customers timelines for payments <em>later</em>. I hesitantly inquired as to whether this would actually effect what was important about the failure.</p>
<p>“No, but it would’ve been more rewarding. It failed anyway, but I would’ve had a better time.”</p>
<p>Ah. Kinda nihilistic but still weirdly romantic about Haskell. What was he doing next?</p>
<p>“After falling in love with Haskell, I decided to go back to school for pure mathematics.”</p>
<p>I thanked him for his time, closed my laptop, and spent the next decade thinking about that conversation. Haskell had honest-to-goodness changed that dude’s life. He had been the kind of person, like me, who wanted to do whatever was necessary to solve practical technical problems, and it had changed him to someone who clearly saw some actual <em>beauty</em> in solving a particular class of problems a particular way. I just don’t see a lot of startup people going back to school as pure math people. Do you know pure math people? I know pure math people. I’ve worked with pure math people. Convincing them to be practical was almost as difficult as them convincing me of the bone-deep beauty of a particular problem solving approach that had zero to do with shipping software.</p>
<p>I spent the next ten years mostly working in startups and consultancies. Throughout, I would think about functional programming once in a while. If I did it enough, would I also start to find writing code beautiful enough to just do it for its own sake, unrelated to the problems I was solving or the dollars I was getting paid to do it?</p>
<p>Almost definitely not. My interest is in making autonomous hackers, which turns out to be a mostly very applied problem. But, I hope to learn enough about it that I can empathize with the guy who went from startups to pure math <a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>. Probably it’s just a language with some nice features that’ll bend my brain a bit. But we’ll find out!</p>
</section>
<section id="resources" class="level2">
<h2 class="anchored" data-anchor-id="resources">Resources</h2>
<p>I’ll be using the following resources for Haskell.</p>
<section id="books" class="level3">
<h3 class="anchored" data-anchor-id="books">Books</h3>
<ol type="1">
<li><a href="https://haskellbook.com/">Haskell Programming from first principles</a>: I’ve heard this book had a lot of exercises. I never learn anything without exercises, so purely from a pedagogical perspective this experiment has no hope of success without them.</li>
<li><a href="https://learn-haskell.blog/">Learn Haskell by building a blog generator</a>: This one is free and involves building some actual software. I love doing exercises to get the gist, but the other thing that frustrates me is getting to the end of a textbook and not really knowing what the <em>right</em> way to structure a project would be if I started one. I’m hoping this book moves me in that direction. ### Software</li>
<li><a href="https://jaspervdj.be/hakyll/">Hakyll</a>: I’ve used Jekyll based blog builders forever. That said, I only knew as much ruby as I needed to edit metasploit modules. I’m hoping to more fully understand this software.</li>
<li><a href="https://github.com/jgm/pandoc/labels/good%20first%20issue">Pandoc</a>: I was sort of shocked to find out pandoc was written in Haskell. Honestly, my brain just combined the fact that pandas is in python, all the document rendering in python has used pandoc, and it starting with a p to decide it was written in python. Stolen valor. Anyway, they’ve also got some starter issues, and closing a few tickets would prove some non-trivial Haskell knowledge I think.</li>
<li><a href="https://github.com/gwern/gwern.net/tree/master">Gwern’s Blog Builder Thing</a>: I really like the look of Gwern’s blog, so I hope to be able to understand the static site builder, which is written in Hakyll, to build something with similar readability and sidenote support.</li>
</ol>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>If we get a statically typed language to express deep learning computations in in such a way that doesn’t provoke madness before the singularity and has the same tier of ecosystem, then I’ll use that. But we don’t have one yet.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>I didn’t, anyway. If you’re one of those really smart college students who’s been programming since you were ten or whatever, move along. I was eating Denny’s in diners with my buds at 3am and reading too many comic books.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Again, I was literally like twenty years old at the time. I didn’t solve any of those problems. Nor, will I say, did I understand the solutions to those problems yet. Time helps.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>As I recall I also had it in my head that the ability to comment on nicely rendered html of a paper that had git tracking on it, if sufficiently aesthetically beautiful, would immediately ensure the business was profitable for a million years. A natural consequence of this is that the modern journal mafia would fall apart, research would be free, and we would be able to autonomously track retracted papers and follow their citations in a big graph that would allow us to be more discerning around reading papers that referenced retracted work. These were all very related problems in my mind. Heady stuff.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>At time of publishing, this probably sounds fairly fantastical. I assure you that even when it happened, 2014 or so, it was fairly fantastical.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>Also, if you end up reading this, I would love to talk to you again. Like, interview you ideally. If you were responsible for technical execution on a research management startup built on a gitlab fork circa 2012-2015ish and you remember Google Plus, you’re probably that person<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>